# =============================================================================
# ðŸš€ ULTIMATE UNIVERSAL UNSLOTH QLoRA PIPELINE (2026 PRODUCTION - FINAL)
# =============================================================================
# 8-STEP STANDARD â€¢ ANY MODEL â€¢ ANY DATASET â€¢ HF HUB/Ollama/LangChain READY
# MARKED WITH # WHERE TO CHANGE FOR NEW PROJECTS
# =============================================================================
# =============================================================================
# STEP 1: DEPENDENCY VALIDATION & GPU OPTIMIZATION (Run Once)
# =============================================================================
import sys, importlib.util, warnings, os, json, torch
from datetime import datetime
warnings.filterwarnings("ignore")

# Install missing packages FIRST
required = ['unsloth', 'trl', 'datasets', 'transformers', 'torch', 'accelerate', 'peft']
missing = [pkg for pkg in required if importlib.util.find_spec(pkg) is None]

if missing:
    print("âŒ MISSING:", " ".join(missing))
    print("\nðŸ“¦ INSTALLING NOW...")
    os.system('pip install -q "unsloth[colab-new]@git+https://github.com/unslothai/unsloth.git" trl>=0.8.0 datasets>=2.18.0 transformers>=4.40.0 accelerate>=0.27.0 peft>=0.10.0')
    print("âœ… INSTALLED! RESTART RUNTIME NOW.")
    sys.exit(0)

# GPU optimization
if torch.cuda.is_available():
    torch.backends.cuda.matmul.allow_tf32 = True
    torch.cuda.empty_cache()
    print(f"âœ… GPU READY: {torch.cuda.get_device_name(0)} ({torch.cuda.get_device_properties(0).total_memory/1e9:.1f}GB)")
else:
    print("âš ï¸  No GPU - use Colab T4/A100")

print("ðŸš€ STEP 0 COMPLETE â†’ PROCEED TO STEP 1!")


########################         USE ABOVE CDE OR BELOW COMMAND FOR FAST SET UP BOTH WORK SAME   ############################################################################


#1)      os.system('pip install -q "unsloth[colab-new]@git+https://github.com/unslothai/unsloth.git" trl>=0.8.0 datasets>=2.18.0 transformers>=4.40.0 accelerate>=0.27.0 peft>=0.10.0')

#2) RESTART SESSION  NEED BECAUSE ==     unsloth[colab-new] modifies CUDA kernels
#   Torch must reload fresh environment                     #    Skip = 100% Dynamo crashes (your earlier error)




